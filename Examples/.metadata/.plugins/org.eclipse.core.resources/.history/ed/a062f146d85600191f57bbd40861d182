#include "user.h"

uint8_t spiData[3];
uint16_t c;
uint32_t tickCtr;
uint32_t prevTick;
SPI_HandleTypeDef spi5;

void userInit(){
	c = 0b1010101010101010;
	tickCtr = 0;
	prevTick = HAL_GetTick();
	spi5 = getSPI5();
}

void userLoop(){

	while(HAL_GetTick() == prevTick);
	tickCtr++;

	if (tickCtr >= 100000){
		//once a second
		sendLED();

		tickCtr = 0;
	}

}

void sendLED(){
	uint8_t r;
	for(r = 0; r < 6; r++){
		//Get Data
		spiData[0] = ~((c & 0xFF00) >> 8);
		spiData[1] = ~(c & 0x00FF);
		spiData[2] = (1 << (r-1));

		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_1, GPIO_PIN_RESET); //Enable Goes Low
		HAL_SPI_Transmit(&spi5, spiData, 3, 10); //Transmit 3 bytes
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_1, GPIO_PIN_SET); //Enable Goes High
	}
}




